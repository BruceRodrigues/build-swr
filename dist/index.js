Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),n=require("dequal/lite"),r=function(){return(r=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var u in n=arguments[r])Object.prototype.hasOwnProperty.call(n,u)&&(e[u]=n[u]);return e}).apply(this,arguments)};function t(e,n,r,t){return new(r||(r=Promise))(function(u,i){function o(e){try{c(t.next(e))}catch(e){i(e)}}function a(e){try{c(t.throw(e))}catch(e){i(e)}}function c(e){e.done?u(e.value):new r(function(n){n(e.value)}).then(o,a)}c((t=t.apply(e,n||[])).next())})}function u(e,n){var r,t,u,i,o={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,t&&(u=2&i[0]?t.return:i[0]?t.throw||((u=t.return)&&u.call(t),0):t.next)&&!(u=u.call(t,i[1])).done)return u;switch(t=0,u&&(i=[2&i[0],u.value]),i[0]){case 0:case 1:u=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,t=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(u=o.trys,(u=u.length>0&&u[u.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!u||i[1]>u[0]&&i[1]<u[3])){o.label=i[1];break}if(6===i[0]&&o.label<u[1]){o.label=u[1],u=i;break}if(u&&o.label<u[2]){o.label=u[2],o.ops.push(i);break}u[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(e,o)}catch(e){i=[6,e],t=0}finally{r=u=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var i={}[0],o=function(e){return e===i},a=!0,c="undefined"!=typeof window?window.addEventListener.bind(window):null,l="undefined"!=typeof document?document.addEventListener.bind(document):null,f={isOnline:function(){return a},isDocumentVisible:function(){if(l){var e=document.visibilityState;if(!o(e))return"hidden"!==e}return!0},registerOnFocus:function(e){c&&l&&(l("visibilitychange",function(){return e()}),c("focus",function(){return e()}))},registerOnReconnect:function(e){c&&(c("online",function(){a=!0,e()}),c("offline",function(){return a=!1}))}},s="undefined"==typeof window||!("undefined"==typeof Deno||!Deno.version||!Deno.version.deno),d=s?null:window.requestAnimationFrame,v=s?null:d?function(e){return d(e)}:function(e){return setTimeout(e,1)},h=s?e.useEffect:e.useLayoutEffect,p=!s&&navigator.connection&&-1!==["slow-2g","2g"].indexOf(navigator.connection.effectiveType),g=function(){};var b=r({onLoadingSlow:g,onSuccess:g,onError:g,onErrorRetry:function(e,n,r,t,u){if(f.isDocumentVisible()&&!("number"==typeof r.errorRetryCount&&u.retryCount>r.errorRetryCount)){var i=Math.min(u.retryCount,8),o=~~((Math.random()+.5)*(1<<i))*r.errorRetryInterval;setTimeout(t,o,u)}},revalidateOnFocus:!0,revalidateOnReconnect:!0,refreshWhenHidden:!1,refreshWhenOffline:!1,shouldRetryOnError:!0,suspense:!1,errorRetryInterval:p?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:p?5e3:3e3,refreshInterval:0,fetcher:function(e){return fetch(e).then(function(e){return e.json()})},compare:n.dequal,isPaused:function(){return!1},cache:new Map},f),y=new WeakMap,m=0;function w(e){var n=null;if("function"==typeof e)try{e=e()}catch(n){e=""}return Array.isArray(e)?(n=e,e=function(e){if(!e.length)return"";for(var n="arg",r=0;r<e.length;++r){var t=void 0;null===e[r]||"object"!=typeof e[r]&&"function"!=typeof e[r]?t=JSON.stringify(e[r]):y.has(e[r])?t=y.get(e[r]):(t=m,y.set(e[r],m++)),n+="@"+t}return n}(e)):e=String(e||""),[e,n,e?"err@"+e:"",e?"req@"+e:""]}var O=e.createContext({});function R(n,r){var t=e.useState({})[1],u=e.useRef(n),i=e.useRef({data:!1,error:!1,isValidating:!1}),o=e.useCallback(function(e){for(var n=!1,o=u.current,a=0,c=Object.keys(e);a<c.length;a++){var l=c[a];o[l]!==e[l]&&(o[l]=e[l],i.current[l]&&(n=!0))}n&&!r.current&&t({})},[]);return h(function(){u.current=n}),[u,i,o]}function C(n){var t=r(r(r({},b),e.useContext(O)),n.length>2?n[2]:2===n.length&&"object"==typeof n[1]?n[1]:{}),u=n.length>2||2===n.length&&"function"==typeof n[1]||null===n[1]?n[1]:t.fetcher;return[n[0],u,t]}O.displayName="SWRConfig";var V=0,S=function(){return++V},x=new WeakMap,k=function(e){return x.has(e)||x.set(e,[{},{},{},{},{},{},{}]),x.get(e)};if(!s){var T=k(b.cache),E=T[0],I=T[1],P=function(e){if(b.isDocumentVisible()&&b.isOnline())for(var n in e)e[n][0]&&e[n][0]()};b.registerOnFocus(function(){return P(E)}),b.registerOnReconnect(function(){return P(I)})}var W=function(e,n,r,t,u,i){void 0===i&&(i=!1);var o=k(e)[2][n],a=[];if(o)for(var c=0;c<o.length;++c)a.push(o[c](i,r,t,u,c>0));return Promise.all(a).then(function(){return e.get(n)})};function j(e,n,r,a){return void 0===a&&(a=!0),t(this,void 0,void 0,function(){var t,c,l,f,s,d,v,h,p,g,b,y;return u(this,function(u){switch(u.label){case 0:if(t=w(n),c=t[0],l=t[2],!c)return[2,i];if(f=k(e),s=f[3],d=f[4],o(r))return[2,W(e,c,e.get(c),e.get(l),i,a)];if(s[c]=S(),d[c]=0,v=s[c],g=!1,"function"==typeof r)try{r=r(e.get(c))}catch(e){r=i,p=e}if(!r||"function"!=typeof r.then)return[3,5];g=!0,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,r];case 2:return h=u.sent(),[3,4];case 3:return b=u.sent(),p=b,[3,4];case 4:return[3,6];case 5:h=r,u.label=6;case 6:return(y=function(){if(v!==s[c]){if(p)throw p;return!0}})()?[2,h]:(o(h)||e.set(c,h),e.set(l,p),d[c]=S(),!g&&y()?[2,h]:[2,W(e,c,h,p,i,a).then(function(e){if(p)throw p;return e})])}})})}var D=function(e,n,r){return e[n]?e[n].push(r):e[n]=[r],function(){var t=e[n],u=t.indexOf(r);u>=0&&(t[u]=t[t.length-1],t.pop())}};function M(){for(var n=this,a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];var l=C(a),f=l[0],d=l[1],p=l[2],g=p.cache,b=k(g),y=b[0],m=b[1],O=b[2],V=b[3],x=b[4],T=b[5],E=b[6],I=w(f),P=I[0],M=I[1],q=I[2],F=I[3],L=e.useRef(!1),z=e.useRef(!1),A=e.useRef(P),H=e.useRef(p),N=function(){var e=g.get(P);return o(e)?p.initialData:e},_=N(),G=g.get(q),J=function(){return o(p.revalidateOnMount)?p.suspense?!L.current&&!o(_):o(p.initialData):p.revalidateOnMount},B=function(){return!!P&&(!!g.get(F)||!L.current&&J())},K=B(),Q=e.useCallback(function(e){z.current||P===A.current&&L.current&&e()},[P]),U=R({data:_,error:G,isValidating:K},z),X=U[0],Y=U[1],Z=U[2],$=e.useCallback(function(e){return void 0===e&&(e={}),t(n,void 0,void 0,function(){var n,r,t,a,c,l,f,s,v,h;return u(this,function(u){switch(u.label){case 0:if(!P||!d)return[2,!1];if(z.current)return[2,!1];if(H.current.isPaused())return[2,!1];n=e.retryCount,r=void 0===n?0:n,t=e.dedupe,a=void 0!==t&&t,c=!0,l=!o(T[P])&&a,u.label=1;case 1:return u.trys.push([1,6,,7]),g.set(F,!0),Z({isValidating:!0}),l||W(g,P,X.current.data,X.current.error,!0),l?(s=E[P],[4,T[P]]):[3,3];case 2:return f=u.sent(),[3,5];case 3:return p.loadingTimeout&&!g.get(P)&&setTimeout(function(){c&&Q(function(){return H.current.onLoadingSlow(P,p)})},p.loadingTimeout),T[P]=null!==M?d.apply(void 0,M):d(P),E[P]=s=S(),[4,T[P]];case 4:f=u.sent(),setTimeout(function(){E[P]===s&&(delete T[P],delete E[P])},p.dedupingInterval),Q(function(){return H.current.onSuccess(f,P,p)}),u.label=5;case 5:return E[P]!==s?[2,!1]:!o(V[P])&&(s<=V[P]||s<=x[P]||0===x[P])?(Z({isValidating:!1}),[2,!1]):(g.set(q,i),g.set(F,!1),v={isValidating:!1},o(X.current.error)||(v.error=i),p.compare(X.current.data,f)||(v.data=f),p.compare(g.get(P),f)||g.set(P,f),Z(v),l||W(g,P,f,v.error,!1),[3,7]);case 6:return h=u.sent(),delete T[P],delete E[P],H.current.isPaused()?(Z({isValidating:!1}),[2,!1]):(g.set(q,h),X.current.error!==h&&(Z({isValidating:!1,error:h}),l||W(g,P,i,h,!1)),Q(function(){return H.current.onError(h,P,p)}),p.shouldRetryOnError&&Q(function(){return H.current.onErrorRetry(h,P,p,$,{retryCount:r+1,dedupe:!0})}),[3,7]);case 7:return c=!1,[2,!0]}})})},[P]);if(h(function(){H.current=p}),h(function(){if(!P)return i;var e=L.current,n=function(){return $({dedupe:!0})};z.current=!1,A.current=P,e&&Z({data:_,error:G,isValidating:K}),(e||J())&&(o(_)||s?n():v(n));var t=!1,u=D(y,P,function(){!t&&H.current.revalidateOnFocus&&(t=!0,n(),setTimeout(function(){return t=!1},H.current.focusThrottleInterval))}),a=D(m,P,function(){H.current.revalidateOnReconnect&&n()}),c=D(O,P,function(e,t,u,i,o){return void 0===e&&(e=!0),void 0===o&&(o=!0),Z(r({error:u,isValidating:i},p.compare(t,X.current.data)?null:{data:t})),!!e&&(o?n:$)()});return L.current=!0,function(){z.current=!0,u(),a(),c()}},[P,$]),h(function(){var e=0;function n(){var n=H.current;n.refreshInterval&&(e=setTimeout(r,n.refreshInterval))}function r(){return t(this,void 0,void 0,function(){var r;return u(this,function(t){switch(t.label){case 0:return r=H.current,X.current.error||!r.refreshWhenHidden&&!r.isDocumentVisible()||!r.refreshWhenOffline&&!r.isOnline()?[3,2]:[4,$({dedupe:!0})];case 1:t.sent(),t.label=2;case 2:return e&&n(),[2]}})})}return n(),function(){e&&(clearTimeout(e),e=0)}},[p.refreshInterval,p.refreshWhenHidden,p.refreshWhenOffline,$]),p.suspense&&o(_)){if(o(G))throw $({dedupe:!0});throw G}var ee=e.useCallback(function(e,n){return j(g,A.current,e,n)},[]),ne={revalidate:$,mutate:ee},re=Y.current;return Object.defineProperties(ne,{data:{get:function(){return re.data=!0,_},enumerable:!0},error:{get:function(){return re.error=!0,G},enumerable:!0},isValidating:{get:function(){return re.isValidating=!0,K},enumerable:!0}}),e.useDebugValue(_),ne}var q=O.Provider;Object.defineProperty(q,"default",{value:b});var F=j.bind(null,b.cache);exports.SWRConfig=q,exports.createCache=function(e){var n=e;return{cache:n,mutate:j.bind(null,n)}},exports.default=M,exports.mutate=F,exports.useSWRInfinite=function(){for(var n=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var c=C(r),l=c[0],f=c[1],s=c[2],d=s.cache,v=s.initialSize,p=void 0===v?1:v,g=s.revalidateAll,b=void 0!==g&&g,y=s.persistSize,m=void 0!==y&&y,O=null;try{O=w(l?l(0,null):null)[0]}catch(e){}var R=e.useState({})[1],V=null;O&&(V="ctx@"+O);var S=null;O&&(S="len@"+O);var x=e.useRef(!1),k=e.useCallback(function(){var e=d.get(S);return o(e)?p:e},[S,p]),T=e.useRef(k());h(function(){x.current?O&&d.set(S,m?T.current:p):x.current=!0},[O]);var E=e.useRef(),I=M(O?["inf",O]:null,function(){return t(n,void 0,void 0,function(){var e,n,r,t,i,a,c,v,h,p,g,y;return u(this,function(u){switch(u.label){case 0:e=d.get(V)||{},n=e.data,r=e.force,t=[],i=k(),a=null,c=0,u.label=1;case 1:return c<i?(v=w(l?l(c,a):null),h=v[0],p=v[1],h?(g=d.get(h),y=b||r||o(g)||o(r)&&0===c&&!o(E.current)||n&&!s.compare(n[c],g),f&&y?null===p?[3,3]:[4,f.apply(void 0,p)]:[3,6]):[3,8]):[3,8];case 2:return g=u.sent(),[3,5];case 3:return[4,f(h)];case 4:g=u.sent(),u.label=5;case 5:d.set(h,g),u.label=6;case 6:t.push(g),a=g,u.label=7;case 7:return++c,[3,1];case 8:return d.delete(V),[2,t]}})})},s);h(function(){E.current=I.data},[I.data]);var P=e.useCallback(function(e,n){if(void 0===n&&(n=!0),!V)return i;if(n&&!o(e)){var r=E.current;d.set(V,{data:r,force:!1})}else n&&d.set(V,{force:!0});return I.mutate(e,n)},[V]),W=e.useCallback(function(e){return S?("function"==typeof e?n=e(k()):"number"==typeof e&&(n=e),"number"==typeof n&&(d.set(S,n),T.current=n),R({}),P(function(e){return e})):i;var n},[S,k,P]),j={size:k(),setSize:W,mutate:P};return Object.defineProperties(j,{error:{get:function(){return I.error},enumerable:!0},data:{get:function(){return I.data},enumerable:!0},revalidate:{get:function(){return I.revalidate},enumerable:!0},isValidating:{get:function(){return I.isValidating},enumerable:!0}}),j};
